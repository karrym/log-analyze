# log-analyze
## What's About

アクセスログを解析するプログラムです。
以下の形式のログファイルを読み込み、解析します。

```
%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"
```

それぞれの項目の意味は以下のとおりです。
- %h    リモートホスト名
- %l    クライアントの識別子
- %u    認証ユーザー名
- %t    リクエストを受信した時刻([day/month/year:hour:minute:second zone]の書式)
- %r    リクエストの最初の行
- %>s   最後のレスポンスのステータス
- %b    HTTPヘッダを除くレスポンスのバイト数。0バイトの場合は「-」と表示される
- %{Referer}i    サーバが受信したリクエストヘッダのReferer
- %{User-Agent}i サーバが受信したリクエストヘッダのUser-Agent

時間帯ごとのアクセス数、ホストごとのアクセス数を集計し、標準出力に結果を出力します。

### 例

```
10.2.3.4 - - [18/Apr/2005:00:10:47 +0900] "GET / HTTP/1.1" 200 854 "-" "Mozilla/4.0 (compatible; MSIE 5.5; Windows 98)"
10.2.3.4 - - [18/Apr/2005:00:10:47 +0900] "GET /style.css HTTP/1.1" 200 102 "http://www.geekpage.jp/" "Mozilla/4.0 (compatible; MSIE 5.5; Windows 98)"
10.2.3.4 - - [18/Apr/2005:00:10:47 +0900] "GET /img/title.png HTTP/1.1" 304 - "http://www.geekpage.jp/" "Mozilla/4.0 (compatible; MSIE 5.5; Windows 98)"
```

## Compile
GHC 8.4.4 をインストールしてあるコンピュータで以下のコマンドを打つことでコンパイルできます。

```
ghc -o log-analyze Main.hs
```

## How to Use
次の形式で実行できます。

```
$ log-analyze FILES [-d BEGIN END]
```

## 実行例
出力のHourはUTCでの時間を意味します。

```
$ log-analyze test/small-test
Accesses per hour
Hour		| Access
------------------------------
00:00-00:59	| 0
01:00-01:59	| 0
02:00-02:59	| 0
03:00-03:59	| 0
04:00-04:59	| 0
05:00-05:59	| 0
06:00-06:59	| 0
07:00-07:59	| 0
08:00-08:59	| 0
09:00-09:59	| 0
10:00-10:59	| 0
11:00-11:59	| 0
12:00-12:59	| 0
13:00-13:59	| 0
14:00-14:59	| 0
15:00-15:59	| 3
16:00-16:59	| 0
17:00-17:59	| 0
18:00-18:59	| 3
19:00-19:59	| 0
20:00-20:59	| 0
21:00-21:59	| 0
22:00-22:59	| 0
23:00-23:59	| 0

Accesses by host
10.2.3.4 : 6
```

```
$ log-analyze test/small-test -d "18/Apr/2005:00:00:00 +0900" "18/Apr/2005:02:00:00 +0900"
Accesses per hour
Hour		| Access
------------------------------
00:00-00:59	| 0
01:00-01:59	| 0
02:00-02:59	| 0
03:00-03:59	| 0
04:00-04:59	| 0
05:00-05:59	| 0
06:00-06:59	| 0
07:00-07:59	| 0
08:00-08:59	| 0
09:00-09:59	| 0
10:00-10:59	| 0
11:00-11:59	| 0
12:00-12:59	| 0
13:00-13:59	| 0
14:00-14:59	| 0
15:00-15:59	| 3
16:00-16:59	| 0
17:00-17:59	| 0
18:00-18:59	| 0
19:00-19:59	| 0
20:00-20:59	| 0
21:00-21:59	| 0
22:00-22:59	| 0
23:00-23:59	| 0

Accesses by host
10.2.3.4 : 3
```
